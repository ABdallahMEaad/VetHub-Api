<!doctype html>
<html lang="en">

    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport"
            content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <title>Detection</title>
        <link rel="icon" href="img/favicon.jpg">
        <!-- Bootstrap CSS -->
        <link rel="stylesheet" href="css/bootstrap.min.css">
        <!-- animate CSS -->
        <link rel="stylesheet" href="css/animate.css">
        <!-- owl carousel CSS -->
        <link rel="stylesheet" href="css/owl.carousel.min.css">
        <!-- themify CSS -->
        <link rel="stylesheet" href="css/themify-icons.css">
        <!-- flaticon CSS -->
        <link rel="stylesheet" href="css/flaticon.css">
        <!-- magnific popup CSS -->
        <link rel="stylesheet" href="css/magnific-popup.css">
        <!-- nice select CSS -->
        <link rel="stylesheet" href="css/nice-select.css">
        <!-- swiper CSS -->
        <link rel="stylesheet" href="css/slick.css">
        <!-- style CSS -->
        <link rel="stylesheet" href="css/style.css">
        <style>
            th, td {
                padding: 8px;
                text-align: center;
                border: 1px solid #ff0000;
            }

            th {
                background-color: #0172FA;
                color: white;
            }

        </style>
    </head>

    <body>
        <!--::header part start::-->
        <header class="main_menu ">
            <div class="container">
                <div class="row align-items-center">
                    <div class="col-lg-12">
                        <nav class="navbar navbar-expand-lg navbar-light">
                            <a class="navbar-brand" href="Loading.html"> <img class="wow animate__fadeInLeft w-50" data-wow-duration="3s" src="img/vethub.png" alt="logo"> </a>
                            <button class="navbar-toggler" type="button" data-toggle="collapse"
                                    data-target="#navbarSupportedContent" aria-controls="navbarSupportedContent"
                                    aria-expanded="false" aria-label="Toggle navigation">
                                <span class="navbar-toggler-icon"></span>
                            </button>
                    
                            <div class="collapse navbar-collapse main-menu-item justify-content-center"
                                 id="navbarSupportedContent">
                                <ul class="navbar-nav align-items-center">
                                    <li class="scroll nav-item"><a class="nav-link nav__link" href="Loading.html">Home</a></li>
                                    <li class="scroll nav-item"><a class="nav-link nav__link" href="#detect">Detect</a></li>
                                    <li class="scroll nav-item dropdown">
                                        <a class="nav-link dropdown-toggle nav__link" href="blog.html" id="navbarDropdown_1" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">Medical News</a>
                                        <div class="dropdown-menu" aria-labelledby="navbarDropdown_1">
                                            <a class="dropdown-item" href="Artical Loading.html">Articles</a>
                                        </div>
                                    </li>
                                    <li class="nav-item w-100 rounded" id="loginLink"><a href="Sign.html"><button class="btn btn-outline-primary rounded-pill w-75"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-box-arrow-in-right" viewBox="0 0 16 16">
                                        <path fill-rule="evenodd" d="M6 3.5a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v9a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-2a.5.5 0 0 0-1 0v2A1.5 1.5 0 0 0 6.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-9A1.5 1.5 0 0 0 14.5 2h-8A1.5 1.5 0 0 0 5 3.5v2a.5.5 0 0 0 1 0z"/>
                                        <path fill-rule="evenodd" d="M11.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 1 0-.708.708L10.293 7.5H1.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708z"/>
                                      </svg>  SignIN</button></a></li>                                    <li class="nav-item" id="logoutLink" style="display: none;"><button class="btn btn-outline-primary" onclick="userLogout()">Logout</button></li>
                                    <li class="nav-item" style="width: 100px;"><span id="welcomeMessage" style="display: none; color: #0172FA; width: 100px; margin-left: 15%; font-weight: bold;"></span></li>
                                </ul>
                            </div>
                        </nav>
                    </div>
                </div>
            </div>
        </header>
        <!-- Header part end-->
        <section id="detect" class="sec" style="background-image: url(../VetHub/img/JxR07.png);background-size: 100% 100%; background-repeat: no-repeat;">
            <div class="container text-center">
                <div class="row">
                    <div class="col-md-6">
                        <div class="img-wrapper">
                            <img src="images-detection/2.png" class="img-fluid mb-5 mt-3" alt="Demo image">
                        </div>
                    </div>
                    <div class="col-md-6 mt-5">
                        <h2 style="color: #0172FA; font-size: 65px; font-style: italic;">Detect Now!</h2>
                        <p style="font-size: 25px; font-weight: bold;color: rgb(255, 255, 255);"> "You can diagnose infectious skin diseases in animals here"</p>
                    </div>
                </div>
            </div>
        </section>
    
        <section id="hero">
            <div class="container">
                <div class="row">          
                    <div class="col-md-7 content-box hero-content">
                        <span>Just</span>
                        <h1>Upload the image <b>now</b></h1>
                        <p>The diseases that can be diagnosed are Foot and Mouth Disease / Infectious Bovine Keratoconjunctivitis /Lumpy Skin/Normal</p>
                        <form id="uploadForm" enctype="multipart/form-data" class="upload-form">
                            <div class="file-upload">
                                <form id="uploadForm" enctype="multipart/form-data" class="upload-form">
                                    <input type="file" class="custom-file-upload" id="fileInput" accept="image/png, image/jpeg" required disabled>
                                    <label for="fileInput" class="custom-file-upload align-items-end" ><i class="fas fa-cloud-upload-alt"></i> Choose File</label>

                                    <button class="btn btn btn-outline-primary mb-2" style="width: 150px; border-radius: 20px;" id="submitBtn" type="submit" disabled>Submit</button>
                                    <p style="font-size: 35px; font-weight: bold; color: red; opacity: 0.7;" id="Span"> <span style="text-decoration: underline; font-size: 35px; font-weight: bold; color: red; opacity: 0.8; font-style: italic;"> U</span> should SignIn first .!</p>
                                </form>
                            </div>
                            
                        </form>
    
                        <div id="result" class="result-container">
                          <div id="classification-result" class="classification-result"></div>
                        </div>
                      
                    </div>
                    <div class="col-lg-5 col-md-5 col-sm-5 col-xs-5">
                        <!-- <img src="img/iphone.png" class="img-fluid" alt="Demo image"> -->
                        <div id="image-container" class="image-container" style="margin-top: 80%;"></div>
                    </div>
                </div>
            </div>
        </section>
    
        <div class="d-none" id="table">
            <div class="row">
                <div class="col-md-12">
                    <h3 style="font-size: 30px; font-weight: bold; font-style: italic; color: #0172FA; margin-left: 3%;" class="mt-5 mb-5" id="table">Your History . . . </h3>
                </div>
                <div class="col-md-12">
                    <table class="w-100 table-striped table-hover border border-primary">
                        <thead>
                            <tr class="table-danger">
                                <th>ID</th>
                                <th>PredictedName</th>
                                <th>Your Image</th>
                                <th>Cause</th>
                                <th>Symptoms</th>
                                <th>Transmission</th>
                                <th>Prevention</th>
                                <th>Treatment</th>
                                <th>Date & Time</th>
                                <!-- <th>Delete</th> -->
                            </tr>
                        </thead>
                        <tbody id="tbodyPredicted">
                           
                        </tbody>
                    </table>
                </div>
            </div>
        </div>

        <!-- footer part start-->
        <footer class="footer-area">
            <div class="footer section_padding">
                <div class="container">
                    <div class="row justify-content-between">
                        <div
                            class="col-xl-2 col-md-4 col-sm-6 single-footer-widget">
                            <a href="#" class="footer_logo"> <img class="w-75"
                                    src="img/vethub.png" alt="#"> </a>
                            <p>Expert Veterinary Care and News is focused on
                                delivering innovative solutions for pet care</p>
                            <div class="social_logo">
                                <a href="#"><i class="ti-facebook"></i></a>
                                <a href="#"> <i class="ti-twitter"></i> </a>
                                <a href="#"><i class="ti-instagram"></i></a>
                                <a href="#"><i class="ti-skype"></i></a>
                            </div>
                        </div>
                        <div
                            class="col-xl-2 col-sm-6 col-md-4 single-footer-widget">
                            <h4>Quick Links</h4>
                            <ul>
                                <li><a href="#">About us</a></li>
                                <li><a href="#">Department</a></li>
                                <li><a href="#"> Online payment</a></li>
                                <li><a href="#">Careers</a></li>
                                <li><a href="#">Department</a></li>
                            </ul>
                        </div>
                        <div
                            class="col-xl-2 col-sm-6 col-md-4 single-footer-widget">
                            <h4>Explore</h4>
                            <ul>
                                <li><a href="#">In the community</a></li>
                                <li><a href="#">IU health foundation</a></li>
                                <li><a href="#">Family support </a></li>
                                <li><a href="#">Business solution</a></li>
                                <li><a href="#">Community clinic</a></li>
                            </ul>
                        </div>
                        <div
                            class="col-xl-2 col-sm-6 col-md-6 single-footer-widget">
                            <h4>Resources</h4>
                            <ul>
                                <li><a href="#">Lights were season</a></li>
                                <li><a href="#"> Their is let wherein</a></li>
                                <li><a href="#">which given over</a></li>
                                <li><a href="#">Without given She</a></li>
                                <li><a href="#">Isn two signs think</a></li>
                            </ul>
                        </div>
                        <div
                            class="col-xl-3 col-sm-6 col-md-6 single-footer-widget">
                            <h4>Newsletter</h4>
                            <p>Seed good winged wherein which night multiply
                                midst does not fruitful</p>
                            <div class="form-wrap" id="mc_embed_signup">
                                <form target="_blank"
                                    action="https://spondonit.us12.list-manage.com/subscribe/post?u=1462626880ade1ac87bd9c93a&amp;id=92a4423d01"
                                    method="get" class="form-inline">
                                    <input class="form-control" name="EMAIL"
                                        placeholder="Your Email Address"
                                        onfocus="this.placeholder = ''"
                                        onblur="this.placeholder = 'Your Email Address '"
                                        required type="email">
                                    <button
                                        class="click-btn btn btn-default text-uppercase">
                                        <i class="ti-angle-right"></i>
                                    </button>
                                    <div
                                        style="position: absolute; left: -5000px;">
                                        <input
                                            name="b_36c4fd991d266f23781ded980_aefe40901a"
                                            tabindex="-1" value
                                            type="text">
                                    </div>

                                    <div class="info"></div>
                                </form>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="copyright_part">
                <div class="container">
                    <div class="row align-items-center">
                        <p
                            class="footer-text m-0 col-lg-8 col-md-12"><!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                            Copyright
                            &copy;<script>document.write(new Date().getFullYear());</script>
                            All rights reserved | This template is made with <i
                                class="ti-heart" aria-hidden="true"></i> by <a
                                target="_blank">VETHUB Team</a>
                            <!-- Link back to Colorlib can't be removed. Template is licensed under CC BY 3.0. -->
                        </p>
                        <div
                            class="col-lg-4 col-md-12 text-center text-lg-right footer-social">
                            <a href="#"><i class="ti-facebook"></i></a>
                            <a href="#"> <i class="ti-twitter"></i> </a>
                            <a href="#"><i class="ti-instagram"></i></a>
                            <a href="#"><i class="ti-skype"></i></a>
                        </div>
                    </div>
                </div>
            </div>
        </footer>
    
    

        <script>
            if (localStorage.getItem("user")) {
                document.getElementById("fileInput").removeAttribute("disabled")
                document.getElementById("submitBtn").removeAttribute("disabled")
                document.getElementById("Span").remove()
                document.getElementById("table").classList.remove("d-none")
            }


            document.getElementById('uploadForm').addEventListener('submit', function(event) {
                event.preventDefault();
                
                var formData = new FormData();
                var fileInput = document.getElementById('fileInput');
                var file = fileInput.files[0];
                formData.append('files', file, file.name);
                fetch('https://vethub-aimodel.onrender.com/predict/', {
                    method: 'POST',
                    body: formData
                })
                .then(response =>  response.json())
                .then(data => {
                    var resultDiv = document.getElementById('result');
                    var imageContainer = document.getElementById('image-container');
                    var classificationResult = document.getElementById('classification-result');
                    
                    var img = document.createElement('img');
                    img.src = URL.createObjectURL(file);
                    img.style.width = '100%';
                    img.style.height = '100%';
                    img.style.border = 'solid 5px #959595';
                    img.style.borderRadius = '15px';
                    img.style.height = '256px';
                    img.style.marginBottom = '15px';
                    imageContainer.innerHTML = '';
                    imageContainer.appendChild(img);
    
                    classificationResult.innerHTML = '';
                    data.forEach(item => {
                        var div = document.createElement('div');
                        div.innerHTML = `<strong style="color:#0172FA; font-weight:bolder ;font-style:italic; font-size:20px;">Disease Name:</strong> <p style="color:black; font-size:28px; font-weight:bolder;">"${item.predicted_class}"</p>`;
                        if (item.predicted_class !== "Normal") {
                            div.innerHTML += `<strong style="color:#0172FA; font-weight:bolder ;font-style:italic; font-size:20px;">Cause:</strong> <p style="color:black; font-weight:bolder;">${item.class_info.Cause}</p>`;
                            div.innerHTML += `<strong style="color:#0172FA; font-weight:bolder ;font-style:italic; font-size:20px;">Symptoms:</strong> <p style="color:black; font-weight:bold;">${item.class_info.Symptoms}</p>`;
                            div.innerHTML += `<strong style="color:#0172FA; font-weight:bolder ;font-style:italic; font-size:20px;">Transmission:</strong> <p style="color:black; font-weight:bold;">${item.class_info.Transmission}</p>`;
                            div.innerHTML += `<strong style="color:#0172FA; font-weight:bolder ;font-style:italic; font-size:20px;">Prevention:</strong> <p style="color:black; font-weight:bold;">${item.class_info.Prevention}</p>`;
                            div.innerHTML += `<strong style="color:#0172FA; font-weight:bolder ;font-style:italic; font-size:20px;">Treatment:</strong> <p style="color:black; font-weight:bold;">${item.class_info.Treatment}</p>`;
                            
                            
                        } else {
                            div.innerHTML += `<strong></strong> ${item.class_info.Info}`;
                        }
                        classificationResult.appendChild(div);
                        localStorage.setItem("userHistory",JSON.stringify(data));
                         //  post history api
            (async function() {
            try {
                let req = await fetch(`http://vethub.runasp.net/api/User/GetUserByEmail?email=${JSON.parse(localStorage.getItem("user")).email}`,{ method:"Get",});
                let res = await req.json();
                localStorage.setItem("userId",JSON.stringify(res))
                var arry = JSON.parse( localStorage.getItem("userHistory")) ;
                data = arry[0] ;
                const formdata = new FormData();
                formdata.append("ImageUrl", `Images/${file.name}`);
                formdata.append("PredictedName", data.predicted_class);
                formdata.append("Cause", data.class_info.Cause);
                formdata.append("Symptoms", data.class_info.Symptoms);
                formdata.append("Transmission", data.class_info.Transmission);
                formdata.append("Prevention", data.class_info.Prevention);
                formdata.append("Treatment", data.class_info.Treatment);
                formdata.append("userId",  JSON.parse(localStorage.getItem("userId")));

                const requestOptions = {
                method: "POST",
                body: formdata,
                redirect: "follow"
                };
                fetch("http://vethub.runasp.net/api/History/AddHistory", requestOptions)
                .then((response) => response.text())
                .then((result) => console.log(result))
                .catch((error) => console.error(error));
                if (response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                const responseData = await response.json();
                document.getElementById('response').textContent = 'History added successfully: ' + JSON.stringify(responseData, null, 2);
             } catch (error) {
                console.error('Error adding history:', error);
                document.getElementById('response').textContent = 'Error adding history: ' + error;
            }
        })();
                    });
                })
                .catch(error => console.error('Error:', error));
            
           
            });

            
//////////////////////////////////////////////////////////////////
            // get history api
            (async function() {
    const requestOptions = {
        method: "GET",
        redirect: "follow"
    };

    await fetch(`http://vethub.runasp.net/api/History/GetAllHistory?userId=${JSON.parse(localStorage.getItem("userId"))}`, requestOptions)
        .then((response) => response.json())
        .then((result) => {
            console.log(result);
            let html = '';
            for (let index = 0; index < result.length; index++) {
                const dateTimeString = result[index].dateOfDetect;
                const dateTime = new Date(dateTimeString);

                const year = dateTime.getFullYear();
                const month = (dateTime.getMonth() + 1).toString().padStart(2, '0');
                const day = dateTime.getDate().toString().padStart(2, '0');
                const hour = dateTime.getHours().toString().padStart(2, '0');
                const minute = dateTime.getMinutes().toString().padStart(2, '0');
                const second = dateTime.getSeconds().toString().padStart(2, '0');

                const formattedDateTime = `${year}-${month}-${day} ${hour}:${minute}:${second}`;

                html += `
                    <tr class="table-primary">
                        <th>${index + 1}</th>
                        <th class="table-danger">${result[index].predictedName}</th>
                        <th>
                            <img src="${result[index].imageUrl}">
                        </th>
                        <th>${result[index].cause}</th>
                        <th>${result[index].symptoms}</th>
                        <th>${result[index].transmission}</th>
                        <th>${result[index].prevention}</th>
                        <th>${result[index].treatment}</th>
                        <th>${formattedDateTime}</th>
                    </tr>`;
                    // <th><button class="btn btn-outline-danger w-100" onclick="deleteHistory(${result[index].id})">Delete</button></th>

            }
            document.querySelector("#tbodyPredicted").innerHTML = html;
        })
        .catch((error) => console.error(error));
})();

//////////////////////////////////////////
            // delete history api
            async function deleteHistory(id) {
                const userId = localStorage.getItem("userId");

                if (!userId) {
                    console.error("User ID not found in local storage.");
                    return;
                }

                const requestOptions = {
                    method: "DELETE",
                    redirect: "follow"
                };

                try {
                    let req = await fetch(`http://vethub.runasp.net/api/History/${id}?userId=${userId}`, requestOptions);
                    if (!req.ok) {
                        throw new Error(`HTTP error! status: ${req.status}`);
                    }
                    let res = await req.json();
                    console.log(res);
                } catch (error) {
                    console.error("Error deleting history:", error);
                }
            }
        </script>

        <!-- External JavaScripts -->
        <!-- jQuery first, then Popper.js, then Bootstrap JS -->
        <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
        <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js" integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49" crossorigin="anonymous"></script>
        <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.1/js/bootstrap.min.js" integrity="sha384-smHYKdLADwkXOn1EmN1qk/HfnUcbVRZyYmZ4qpPea6sjB/pTJ0euyQp0Mk8ck+5T" crossorigin="anonymous"></script>
        <!-- jquery plugins here-->
        <script src="js/jquery-1.12.1.min.js"></script>
        <!-- popper js -->
        <script src="js/popper.min.js"></script>
        <!-- bootstrap js -->
        <script src="js/bootstrap.min.js"></script>
        <!-- owl carousel js -->
        <script src="js/owl.carousel.min.js"></script>
        <script src="js/jquery.nice-select.min.js"></script>
        <!-- contact js -->
        <script src="js/jquery.ajaxchimp.min.js"></script>
        <script src="js/jquery.form.js"></script>
        <script src="js/jquery.validate.min.js"></script>
        <script src="js/mail-script.js"></script>
        <script src="js/contact.js"></script>
        <!-- custom js -->
        <script src="js/custom.js"></script>
    </body>

</html>